# ProbMinesweeper

*ProbMinesweeper: 数学と戦略が出会う場所* 🎯💣

地雷の確率をリアルタイムで計算・表示する高度なマインスイーパーゲームです。

TopCoder Marathon Match 122 で使用した、BDD ベースの爆弾埋設確率計算アルゴリズムを流用しています

参考: https://www.topcoder.com/challenges/bb7a2759-8aa3-464e-8300-fb175a8efcae

## 特徴

- **リアルタイム確率表示**: 未開封のマスに地雷が埋まっている確率を表示
- **視覚的リスク評価**: 確率に基づいて緑（安全）から赤（危険）まで色分け表示
- **インテリジェント自動オープン**: 確率0%のマスを自動で開く機能（オプション）
- **高度な確率計算**: 組み合わせ論的アルゴリズムで地雷確率を計算
- **レスポンシブデザイン**: デスクトップ・モバイル両対応
- **ゲーム状態管理**: 勝敗判定と視覚的フィードバック

## 遊び方

1. ブラウザで `index.html` を開く
2. 盤面サイズ（幅・高さ）と地雷数を設定
3. 必要に応じて「自動オープン (危険度0%)」を有効化
4. 「新しく始める」をクリックしてゲーム開始
5. 左クリックでマスを開く、右クリックで地雷フラグを設置
6. 確率パーセンテージを参考に戦略的にプレイ

## 確率計算アルゴリズム

### JavaScript組み合わせ論ソルバー (`solver.js`)

**アルゴリズム**: 制約充足問題と組み合わせ論的解析

**主要コンポーネント**:
- **フロンティア検出**: 開いた数字マスに隣接する未開封マスを特定
- **制約生成**: 開示された数字に基づく数学的制約を作成
- **組み合わせ列挙**: 有効な地雷配置を体系的に探索
- **確率計算**: 二項係数を使った効率的な組み合わせ計算

**処理フロー**:
1. 現在の盤面状態を解析し、「フロンティア」（数字に隣接する未開封マス）を特定
2. 各数字マスに対して制約を生成: `隣接地雷数 = マスの数字`
3. 深さ優先探索で制約を満たす全ての有効な地雷配置を列挙
4. 各有効配置に対して、残り地雷の配置方法数を計算
5. 結果を集約して各フロンティアマスの確率を算出

**時間計算量**: O(2^f) (fはフロンティアサイズ)、制約伝播で最適化

## 技術実装

### アーキテクチャ

```
├── index.html          # メインゲームインターフェースとスタイル
├── main.js            # ゲームロジックとUI管理
├── solver.js          # JavaScript確率計算機
└── README.md          # このドキュメント
```

### 主要JavaScript関数

- `computeProbabilities(board, totalBombs)`: 確率計算のメインエントリーポイント
- `autoOpenCells(cells, index)`: 視覚的フィードバック付きインテリジェント自動オープン
- `updateDisplay()`: 確率情報の描画と自動オープンのトリガー
- `checkWin()`: ゲーム状態管理と勝利判定

### 確率表示

確率値は直感的なリスク評価のために色分けされています：
- **緑 (0-10%)**: 非常に安全なマス
- **黄緑 (10-30%)**: 低リスク
- **オレンジ (30-70%)**: 中リスク
- **赤 (70-100%)**: 高リスク（パルスアニメーション付き）

## アルゴリズム性能

組み合わせ論的アプローチによりJavaScriptでリアルタイム確率計算を実現。フロンティアサイズ約15マスまで効率的に処理可能。

## 数学的基盤

確率計算は以下に基づいています：

1. **制約充足**: 各開示数字が隣接マスに制約を作成
2. **ベイズ推論**: P(地雷|制約) を有効配置から計算
3. **組み合わせ計数**: 数学的恒等式を使った効率的列挙

**公式**:
```
P(マスに地雷あり) = (地雷ありの有効配置数) / (総有効配置数)
```

ここで有効配置とは、全ての開示数字制約を満たす配置を指します。

## 開発

### 実行方法
ブラウザで `index.html` を開き、様々な盤面設定でテストしてください。

## 参考文献

- [BDD/ZDDを用いたマインスイーパーの爆弾配置パタンの列挙](https://www.ai-gakkai.or.jp/jsai2016/webprogram/2016/pdf/927.pdf) - 人工知能学会全国大会論文集 (2016)

## ライセンス

このプロジェクトは [MIT License](LICENSE) の下で公開されています。
